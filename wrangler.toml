name = "tmc-file-transfer"
compatibility_date = "2024-08-21"

# Pages configuration
pages_build_output_dir = "./dist"

# Environment variables
[env.production.vars]
ENVIRONMENT = "production"
MAX_FILE_SIZE = "5368709120"  # 5GB in bytes (supports large files via multipart upload)
ALLOWED_ORIGINS = "https://upload.frisson.social"
TURNSTILE_SITE_KEY = "0x4AAAAAABuG5x3RAnK97btK"
TURNSTILE_SECRET_KEY = "0x4AAAAAABuG51VCoK0GijK7ULELVtkO4nY"
CLOUDFLARE_ZONE_ID = "97d4cbc4306ea586a3a49ad0e990bbc1"
MIGRATION_AUTH_TOKEN = "60783c701772cd54705c828cbc12c111a2a088dba33455e0149fc9fc490c24fb"
CLEANUP_SECRET = "800d64236054fc30b9f52dd43e8b6eea95b669a95a1c2a675ed1ef233b84c9d4"

# D1 Database binding for production
[[env.production.d1_databases]]
binding = "DB"
database_name = "tmc-file-transfer"
database_id = "dde71e0c-af96-4e8a-9f4b-c2f89b2c2a30"

# R2 Storage binding for production
[[env.production.r2_buckets]]
binding = "TRANSFER_BUCKET"
bucket_name = "tmc-transfers"

[env.preview.vars]
ENVIRONMENT = "preview"
MAX_FILE_SIZE = "5368709120"  # 5GB in bytes (supports large files via multipart upload)
ALLOWED_ORIGINS = "*"
TURNSTILE_SITE_KEY = "1x00000000000000000000AA"  # Test key for preview
TURNSTILE_SECRET_KEY = "1x0000000000000000000000000000000AA"  # Test key for preview
MIGRATION_AUTH_TOKEN = "60783c701772cd54705c828cbc12c111a2a088dba33455e0149fc9fc490c24fb"
CLEANUP_SECRET = "800d64236054fc30b9f52dd43e8b6eea95b669a95a1c2a675ed1ef233b84c9d4"

# D1 Database binding for preview
[[env.preview.d1_databases]]
binding = "DB"
database_name = "tmc-file-transfer"
database_id = "dde71e0c-af96-4e8a-9f4b-c2f89b2c2a30"

# R2 Storage binding for preview
[[env.preview.r2_buckets]]
binding = "TRANSFER_BUCKET"
bucket_name = "tmc-transfers"

# KV namespace for caching (optional)
#[[kv_namespaces]]
#binding = "CACHE"
#id = "your-kv-namespace-id"
#preview_id = "your-kv-preview-id"

# Analytics Engine for logging (commented out - needs setup)
#[[analytics_engine_datasets]]
#binding = "ANALYTICS"
#dataset = "tmc_file_transfer_logs"

# Cleanup Worker Configuration
# The cleanup worker is deployed separately using the shared configuration below
# Run: npm run deploy:cleanup or npm run deploy:cleanup:preview

# Note: Pages doesn't support [limits], [build], or [[rules]] sections
# These are handled automatically by the Pages platform

# Headers configuration
[env.production.headers]
"/*" = [
  { name = "X-Frame-Options", value = "DENY" },
  { name = "X-Content-Type-Options", value = "nosniff" },
  { name = "X-XSS-Protection", value = "1; mode=block" },
  { name = "Referrer-Policy", value = "strict-origin-when-cross-origin" },
  { name = "Strict-Transport-Security", value = "max-age=31536000; includeSubDomains" },
  { name = "Permissions-Policy", value = "geolocation=(), microphone=(), camera=()" }
]

# Cache configuration for static assets
[env.production.caching]
"/assets/*" = { edge_ttl = 31536000, browser_ttl = 31536000 }
"/favicon*" = { edge_ttl = 31536000, browser_ttl = 31536000 }
"*.js" = { edge_ttl = 31536000, browser_ttl = 31536000 }
"*.css" = { edge_ttl = 31536000, browser_ttl = 31536000 }